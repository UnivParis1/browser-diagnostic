<!DOCTYPE html>
<html>
    <header>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </header>
    <script src="browser-releaseDates.js"></script>
    <script src="lib.js"></script>
    <script>
const tests = [
    [ 
        `Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36`,
        { name: 'Chrome', major: '87', old_info: 'depuis au moins 2 ans', suggest_macos_upgrade: true }
    ],    
    [ 
        `Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36`,
        { name: 'Chrome', major: '109', old_info: 'depuis au moins 6 mois', suggest_windows_firefox_ESR: true }
    ],
    [ 
        `Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.3`,
        { name: 'Chrome', major: '123', firstReleaseDate: new Date('2024-3-13'), latestReleaseDate: new Date('2024-4-15'), eol: new Date('2024-04-09 23:00:00Z') }
    ],
    [
        `Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.3 Safari/605.1.15`,
        // NB : la version 13.1.3 est inconnue...
        { name: 'Safari', major: '13', version: '13.1', full_version: '13.1.3', firstReleaseDate: new Date('28 jan 2020'), latestReleaseDate: new Date('15 jul 2020'), suggest_macos_upgrade: true }
    ],
    [
        `Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.6.1 Safari/605.1.15`,
        { name: 'Safari', major: '15', version: '15.6', full_version: '15.6.1', firstReleaseDate: new Date('20 sep 2021'), latestReleaseDate: new Date('18 aug 2022'), suggest_macos_firefox_chrome: true }
    ],
    [
        `Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.5 Safari/605.1.150.61`,
        { name: 'Safari', major: '16', version: '16.5', full_version: '16.5', firstReleaseDate: new Date('12 sep 2022'), latestReleaseDate: new Date('18 may 2023'), suggest_macos_firefox_chrome: true }
    ],
    [
        `Mozilla/5.0 (Macintosh; Intel Mac OS X 14.4; rv:125.0) Gecko/20100101 Firefox/78.0`,
        { name: 'Firefox', major: '78', firstReleaseDate: new Date("2020-06-30"), latestReleaseDate: new Date('2021-10-05'), eol: new Date('2021-11-02'), suggest_macos_upgrade: true }
    ],
    [
        `Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101 Firefox/91.0`,
        { name: 'Firefox', major: '91', firstReleaseDate: new Date("2021-08-10"), latestReleaseDate: new Date('2022-08-23'), eol: new Date("2022-09-20") }
    ],
    [
        `Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101 Firefox/115.0`,
        { name: 'Firefox', major: '115', firstReleaseDate: new Date("2023-07-04"), latestReleaseDate: new Date('2024-04-16'), eol: new Date("2024-10-01") }
    ],
    [
        `Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101 Firefox/116.0`,
        { name: 'Firefox', major: '116', firstReleaseDate: new Date("2023-08-01"), latestReleaseDate: new Date('2023-08-16'), eol: new Date("2023-08-29") }
    ],
    [
        `Mozilla/5.0 (Macintosh; Intel Mac OS X 14.4; rv:125.0) Gecko/20100101 Firefox/125.0`,
        { name: 'Firefox', major: '125', firstReleaseDate: new Date("2024-04-16"), latestReleaseDate: new Date('2024-04-29'), eol: null }
    ],
    [
        `Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36 Edg/123.0.0.`,
        { name: 'Edge', major: '123', firstReleaseDate: new Date('22-Mar-2024'), eol: new Date('19-Apr-2024 01:00:00') }
    ],
    [
        `Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36 Edg/122.0.0.`,
        { name: 'Edge', major: '122', firstReleaseDate: new Date('23-Feb-2024'), eol: new Date('19-Apr-2024 01:00:00'), isExtended: true }
    ],

]
let errs = 0
    for (const test of tests) {
        const [ua, expected] = test
        const got = get_info(ua)
        const got_ = JSON.stringify(got)
        const expected_ = JSON.stringify(expected)
        if (got_ !== expected_) {
            errs++
            document.write("<p></p>Pb: ")
            document.write("<br>got<br>" + got_)
            document.write("<br>expected<br>" + expected_)
            console.error("got", got, "vs expected", expected)
        }
    }
    if (!errs) {
        document.write("All ok!")
        for (const test of tests) {
            const [ua, expected] = test
            const level = ''
            const app = 'APP'
            const msgs = compute_msgs(level, app, ua, new Date('2024-05-01'))
            document.write("<pre>" + JSON.stringify(expected, undefined, '  ') + "</pre>")
            document.write(msgs.join("<p></p>"))
            document.write(`<br><a href='index.html?${new URLSearchParams({ app, level, emulate: ua })}'>emulate</a>`)
            document.write('<hr>')
        }
    }
    </script>
</html>